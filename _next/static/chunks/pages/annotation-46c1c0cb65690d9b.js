(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[655],{223:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/annotation",function(){return t(8614)}])},9427:function(e,n,t){"use strict";t.d(n,{Z:function(){return PostComment}});var a=t(1309),i=t(5893),s=t(7294),o=t(7066),r=t(7904);function PostComment(e){var n=e.user,t=e.pid,c=e.aid,l=e.type,d=e.onNewComment,u=(0,a._)((0,s.useState)(""),2),m=u[0],f=u[1];return(0,i.jsx)("form",{className:"comment-form inline-items",onSubmit:function(e){e.preventDefault()},children:(0,i.jsxs)("div",{className:"comment-form-container post__author author vcard inline-items",children:["performance"!=l?(0,i.jsx)(i.Fragment,{children:n&&n.avatar?(0,i.jsx)("img",{loading:"lazy",src:n.avatar,alt:"author",width:"36",height:"36"}):(0,i.jsx)("img",{loading:"lazy",src:"img/dalle_avatar.png",alt:"author",width:"36",height:"36"})}):(0,i.jsx)(i.Fragment,{}),(0,i.jsxs)("div",{className:"comment-form-item form-group is-empty",children:[(0,i.jsx)("textarea",{name:"comment",value:m,className:"comment-form-area form-control",placeholder:"Write a comment...",onChange:function(e){f(e.target.value)}}),(0,i.jsx)("span",{className:"material-input"})]}),(0,i.jsx)("button",{className:"comment-form-item btn btn-md-2 btn-primary",onClick:function(){var e=(0,r.LH)(),a="",i=null;l&&"performance"==l?(a=e+"/api/text_comment",i={annotation_id:c,content:m}):(a=e+"/api/comment_post",i={pid:t,user_id:n.uid,content:m}),(0,o.Z)({method:"POST",url:a,data:i}).then(function(e){f(""),d&&d(m)}).catch(function(e){console.log(e)})},children:"Post Comment"})]})})}},8345:function(e,n,t){"use strict";t.d(n,{Z:function(){return ListPostComment}});var a=t(1309),i=t(4586),s=t(5893),o=t(7066),r=t(7904),c=t(8878),l=t(7294);function ListPostComment(e){var n=e.pid,t=e.userId,d=e.type,u=e.needCommentRefresh,m=e.setNeedCommentRefresh,f=(0,a._)((0,l.useState)("en"),2),h=f[0],v=f[1],x=(0,a._)((0,l.useState)([]),2),p=x[0],g=x[1],j=(0,a._)((0,l.useState)({}),2),_=j[0],b=j[1],load_comments=function(){var e=(0,r.LH)(),a="",i=null;d&&"performance"==d?(a=e+"/api/list_text_comment",i={annotation_id:n,user_id:t}):(a=e+"/api/list_post_comment",i={pid:n}),(0,o.Z)({method:"POST",url:a,data:i}).then(function(e){var n=e.data;n.comments&&g(n.comments)}).catch(function(e){console.log(e)})},deleteComment=function(e){var n=e.cid;(0,c.$s)(n,d,function(){g(p.filter(function(e){return e.cid!==n}))})},react=function(e,n,t){var a=n.feedback;if(a&&a.feedback==t)(0,c.yz)(a.fid,function(n){if(n.message){var t=(0,i._)(p);t[e].feedback=null,g(t)}});else{var s={text_comment_id:n.cid,user_feedback_id:_.uid,feedback:t};(0,c.NC)(s,function(n){var a=n.fid;if(a){var s=(0,i._)(p);s[e].feedback={fid:a,feedback:t},g(s)}})}};return(0,l.useEffect)(function(){v((0,r.G3)()),b((0,r.PR)()),load_comments()},[]),(0,l.useEffect)(function(){u&&(load_comments(),m(!1))},[u]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("ul",{className:"comments-list",children:p.map(function(e,n){return(0,s.jsxs)("li",{className:"comment-item "+("performance"==d?"performance-comment-item":""),children:[(0,s.jsxs)("div",{className:"post__author author vcard inline-items",children:[d&&"performance"==d?(0,s.jsx)(s.Fragment,{}):(0,s.jsx)("img",{loading:"lazy",src:e.avatar,width:"36",height:"36",alt:"author"}),(0,s.jsxs)("div",{className:"author-date",children:[(0,s.jsx)("a",{className:"h6 post__author-name fn",href:"/profile?uid="+e.user_id,children:e.fullname}),(0,s.jsx)("div",{className:"post__date",children:(0,s.jsx)("time",{className:"published",dateTime:e.updated_at,children:e.updated_at})})]}),(0,s.jsxs)("div",{className:"more",children:[(0,s.jsx)("svg",{className:"olymp-three-dots-icon",children:(0,s.jsx)("use",{xlinkHref:"#olymp-three-dots-icon"})}),_.uid==e.user_id?(0,s.jsx)("ul",{className:"more-dropdown",children:(0,s.jsx)("li",{children:(0,s.jsxs)("a",{onClick:function(){return deleteComment(e)},children:[(0,s.jsx)("i",{className:"fa fa-trash"}),"\xa0",(0,r.id)(h,"delete_comment")]})})}):(0,s.jsx)(s.Fragment,{})]})]}),(0,s.jsx)("p",{children:e.content}),"performance"==d&&"student"==_.user_type&&(0,s.jsx)("div",{className:"reaction-info post-additional-info inline-items",children:(0,s.jsxs)("div",{className:"reaction-button-area",children:[(0,s.jsx)("button",{className:"reaction-button inline-items "+(e.feedback&&1==e.feedback.feedback?"reaction-active":""),onClick:function(){return react(n,e,1)},children:(0,s.jsx)("i",{className:"far fa-thumbs-up"})}),(0,s.jsx)("button",{className:"reaction-button inline-items "+(e.feedback&&0==e.feedback.feedback?"reaction-active":""),onClick:function(){return react(n,e,0)},children:(0,s.jsx)("i",{className:"far fa-thumbs-down"})})]})})]},e.cid)})}),(0,s.jsxs)("a",{className:"more-comments",onClick:function(){},children:[(0,r.id)(h,"view_more_comments")," ",(0,s.jsx)("span",{children:"+"})]})]})}},8614:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return Annotation}});var a=t(2253),i=t(1309),s=t(4586),o=t(5893),r=t(7294),c=t(9332),l=t(1664),d=t.n(l),u=t(5766),m=t(4932),f=t(9806),h=t(9427),v=t(7904),x=t(2341),p=t(8878),g=t(8345),j=t(1010),_=t(7582),b=t(7066),w=t(6180);function SimpleAudioPlayer(e){var n=e.url;return(0,o.jsx)(w.Z,{src:n})}t(3692);var N=t(2968);function VoiceRecorder(e){var n=e.isShow,t=e.closePopup,a=e.onFinish,i=(0,N.I)();return(0,o.jsx)("div",{className:"modal fade voice-recorder "+(n?"show":""),children:(0,o.jsx)("div",{className:"modal-dialog window-popup",role:"document",children:(0,o.jsxs)("div",{className:"modal-content",children:[(0,o.jsx)("a",{className:"close icon-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:function(){i.stopRecording(),t()},children:(0,o.jsx)("svg",{className:"olymp-close-icon",children:(0,o.jsx)("use",{xlinkHref:"#olymp-close-icon"})})}),(0,o.jsx)("div",{className:"modal-body",children:(0,o.jsx)(N.h,{onRecordingComplete:a,audioTrackConstraints:{noiseSuppression:!0,echoCancellation:!0},downloadOnSavePress:!1,downloadFileExtension:"wav"})})]})})})}var voice_comment=function(e){var n,t,c=e.user,l=(e.pid,e.aid),d=e.enable,u=(0,i._)((0,r.useState)("en"),2),f=u[0],h=u[1],x=(0,r.useRef)(),g=(0,i._)((0,r.useState)(25),2),w=g[0];g[1];var N=(0,i._)((0,r.useState)(1),2),y=N[0];N[1];var k=(0,i._)((0,r.useState)({name:"",short_name:""}),2),S=k[0],C=k[1],P=(0,i._)((0,r.useState)(null),2),I=P[0],M=P[1],T=(0,i._)((0,r.useState)({annotation_id:l,type:0,path:""}),2),A=T[0],E=T[1],L=(0,i._)((0,r.useState)([]),2),B=L[0],R=L[1],F=(0,i._)((0,r.useState)(!1),2),H=F[0],z=F[1],D=(n=(0,j._)(function(e){var n;return(0,_.Jh)(this,function(t){return(n=e.target.files[0]).name.includes(".mid")||n.name.includes(".mp3")||n.name.includes(".wav")||n.name.includes(".midi")?(C({name:n.name,short_name:n.name}),M(n)):alert((0,v.id)(f,file_acceptance_notice)),[2]})}),function(e){return n.apply(this,arguments)}),processBeforeUpload=function(e){var n=localStorage.getItem("backend_url"),t=new FormData;t.append("file",I,S.name),b.Z.post(n+"/api/upload_audio",t).then(function(n){var t=n.data;t.path?e(t.path):alert((0,v.id)(f,"error_upload_file"))})},loadList=function(){(0,p.Ns)(l,c.uid,w,y,function(e){R(e.comments),console.log(e.comments)})},O=(t=(0,j._)(function(e){var n,t,a;return(0,_.Jh)(this,function(i){switch(i.label){case 0:return[4,fetch(e.path)];case 1:return[4,i.sent().blob()];case 2:return n=i.sent(),t=window.URL.createObjectURL(n),(a=document.createElement("a")).href=t,a.download="test.mid",document.body.appendChild(a),a.click(),a.remove(),[2]}})}),function(e){return t.apply(this,arguments)}),react=function(e,n,t){var a=n.feedback;if(a&&a.feedback==t)(0,p.yz)(a.fid,function(n){if(n.message){var t=(0,s._)(B);t[e].feedback=null,R(t)}});else{var i={voice_comment_id:n.cid,user_feedback_id:c.uid,feedback:t};(0,p.Q_)(i,function(n){var a=n.fid;if(a){var i=(0,s._)(B);i[e].feedback={fid:a,feedback:t},R(i)}})}};return(0,r.useEffect)(function(){h((0,v.G3)()),loadList()},[]),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("form",{className:"performance-form",onSubmit:function(e){e.preventDefault()},children:[(0,o.jsx)("ul",{className:"voice-list",onMouseDown:function(e){e.stopPropagation()},children:B.length?(0,o.jsx)(o.Fragment,{children:B.map(function(e,n){return(0,o.jsxs)("li",{className:"voice-list-item",onClick:function(){"MIDI"!=(0,v.JB)(e.path)?R(B.map(function(e,t){return t===n?(0,m._)((0,a._)({},e),{audio:!e.audio}):e})):O(e)},children:[(0,o.jsxs)("div",{className:"voice-list-item-content flex",children:[(0,o.jsxs)("div",{className:"voice-list-item-text",children:["Comment on ",e.updated_at]}),(0,o.jsx)("div",{children:e.audio?(0,o.jsx)("i",{className:"fa fa-chevron-down"}):(0,o.jsx)("i",{className:"fa fa-chevron-right"})})]}),e.audio&&(0,o.jsx)("div",{style:{marginTop:"10px"},children:(0,o.jsx)(SimpleAudioPlayer,{url:e.path})}),"student"==c.user_type&&(0,o.jsx)("div",{className:"reaction-info post-additional-info inline-items",onClick:function(e){e.stopPropagation()},children:(0,o.jsxs)("div",{className:"reaction-button-area",children:[(0,o.jsx)("button",{className:"reaction-button inline-items "+(e.feedback&&1==e.feedback.feedback?"reaction-active":""),onClick:function(){return react(n,e,1)},children:(0,o.jsx)("i",{className:"far fa-thumbs-up"})}),(0,o.jsx)("button",{className:"reaction-button inline-items "+(e.feedback&&0==e.feedback.feedback?"reaction-active":""),onClick:function(){return react(n,e,0)},children:(0,o.jsx)("i",{className:"far fa-thumbs-down"})})]})})]},e.cid)})}):(0,o.jsx)("li",{className:"voice-list-item",style:{textAlign:"center",background:"none"},children:(0,v.id)(f,"no_voice_comment")})}),d&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:"performance-form-content "+(S.name?"show":""),children:(0,o.jsxs)("div",{className:"form-group upload-result",children:[(0,o.jsxs)("div",{className:"upload-result-text",children:[(0,v.id)(f,"your_file_is")," ",(0,o.jsxs)("b",{children:['"',S.name,'"']})]}),(0,o.jsx)("a",{className:"inline-items",onClick:function(){x.current.value="",C((0,m._)((0,a._)({},S),{name:"",short_name:""})),M(null)},children:(0,o.jsx)("svg",{className:"olymp-status-icon",children:(0,o.jsx)("use",{xlinkHref:"#olymp-close-icon"})})})]})}),(0,o.jsxs)("div",{className:"add-options-message add-options-message_both recording-bottom",children:[(0,o.jsxs)("div",{className:"flex recording-action",children:[(0,o.jsxs)("div",{className:"inline-flex",children:[(0,o.jsx)("button",{className:"btn btn-outline-primary",onClick:function(){x.current.click()},children:(0,o.jsx)("i",{className:"fa fa-file-audio"})}),(0,o.jsx)("input",{type:"file",className:"file-upload__input",ref:x,onChange:D,accept:".mid, .midi, .mp3, .wav"})]}),(0,o.jsx)("div",{className:"inline-flex",children:(0,o.jsx)("button",{className:"btn btn-outline-primary",onClick:function(){z(!0)},children:(0,o.jsx)("i",{className:"fa fa-microphone"})})})]}),(0,o.jsxs)("div",{className:"recording-upload-container",children:[(0,o.jsx)("fieldset",{className:"form-group",style:{marginBottom:0},children:(0,o.jsxs)("select",{className:"form-select",value:A.type,onChange:function(e){E((0,m._)((0,a._)({},A),{type:e.target.value}))},children:[(0,o.jsx)("option",{value:"0",children:(0,v.id)(f,"comment")}),(0,o.jsx)("option",{value:"1",children:(0,v.id)(f,"ideal")})]})}),(0,o.jsxs)("button",{className:"btn btn-primary btn-md-2",onClick:function(){processBeforeUpload(function(e){var n=(0,a._)({},A);n.path=e,(0,p.h6)(n,function(e){e.message&&(alert("Success!"),C({name:"",short_name:""}),loadList())})})},children:[(0,o.jsx)("i",{className:"fa fa-upload"}),"\xa0",(0,v.id)(f,"upload")]})]})]})]})]}),(0,o.jsx)(VoiceRecorder,{isShow:H,closePopup:function(){z(!1)},onFinish:function(e){var n="Recording_"+(0,v.Xn)()+".wav";M(e),C({name:n,short_name:n}),z(!1)}})]})};function StarMetric(e){var n=e.value,t=e.id,a=e.selectAction,i=e.style,c=e.enable,l=(0,r.useRef)(),getChildren=function(){return l.current.querySelectorAll(".star-button")},handleHoverEnter=function(e){if(c)for(var n=getChildren(),t=0;t<n.length;t++)t<=e&&n[t].classList.add("hovered")},handleHoverLeave=function(){for(var e=getChildren(),n=0;n<e.length;n++)e[n].classList.remove("hovered")},handleClick=function(e){a&&(e+1==n?(a(0),handleHoverLeave()):a(e+1))};return(0,o.jsx)("div",{className:"star-rating",id:t,ref:l,children:(0,s._)([,,,,,]).map(function(e,a){var s=a<<1,c=s+1;return(0,o.jsxs)(r.Fragment,{children:[(0,o.jsx)("button",{type:"button",className:"star-button half-left "+(n&&n>s?"selected":""),onMouseEnter:function(){return handleHoverEnter(s)},onMouseLeave:function(){return handleHoverLeave()},onClick:function(){handleClick(s)},style:i}),(0,o.jsx)("button",{type:"button",className:"star-button half-right "+(n&&n>c?"selected":""),onMouseEnter:function(){return handleHoverEnter(c)},onMouseLeave:function(){return handleHoverLeave()},onClick:function(){handleClick(c)},style:i})]},t+a)})})}function Level2Scale(e){var n=e.score,t=(e.parentId,e.id),a=e.enable,s=e.labels,c=e.onChange,l=(0,i._)((0,r.useState)("en"),2),d=l[0],u=l[1],m=(0,i._)((0,r.useState)({observation:0,suggestion:0}),2),f=m[0],h=m[1],encode=function(e,n){return e<<4|n},changeHandler=function(e){if(a){if(0==f.observation||0!=f.suggestion)c(t,encode(0,e));else if(0!=f.observation){var n=f.observation;f.observation==e&&(e=0,n=0),c(t,encode(e,n))}}};return(0,r.useEffect)(function(){var e=n>>4;h({observation:15&n,suggestion:e})},[n]),(0,r.useEffect)(function(){u((0,v.G3)())},[]),(0,o.jsx)(o.Fragment,{children:(0,o.jsxs)(r.Fragment,{children:[(0,o.jsxs)("div",{className:"annotation-item-sub-title",children:[(0,o.jsx)("div",{className:"inline-flex",children:s[0]}),(0,o.jsxs)("div",{className:"fix-pos",children:[(0,o.jsx)("div",{className:"line",children:(0,o.jsx)("i",{className:"fa fa-chevron-left"})}),(0,o.jsx)("span",{style:{minWidth:"50px"},children:x.S[d].neutral}),(0,o.jsx)("div",{className:"line",children:(0,o.jsx)("i",{className:"fa fa-chevron-right"})})]}),(0,o.jsx)("div",{className:"inline-flex",children:s[1]})]}),(0,o.jsx)("div",{className:"annotation-slider-container",children:Array.from({length:7},function(e,n){var a;return(0,o.jsx)("input",{className:"radio "+(n+1==f.suggestion?"radio-suggest":""),type:"checkbox",name:"annotationRadio_"+t,value:n+1,checked:(a=n+1)==f.observation||a==f.suggestion,onChange:function(e){changeHandler(e.target.value)}},n)})})]})})}function AnnotationForm(e){var n=e.x,t=e.y,s=e.pid,c=e.aid,l=e.annotation,d=e.assignment,f=e.enable,j=e.show,_=e.close,b=e.save,w=e.remove,N=e.update,y=(0,i._)((0,r.useState)("en"),2),k=y[0],S=y[1],C=(0,i._)((0,r.useState)({x:n,y:t}),2),P=C[0],I=C[1],M=(0,i._)((0,r.useState)(!1),2),T=M[0],A=M[1],E=(0,i._)((0,r.useState)({x:0,y:0}),2),L=E[0],B=E[1],R=(0,i._)((0,r.useState)({}),2),F=R[0],H=R[1],z=(0,i._)((0,r.useState)(c),2),D=z[0],O=z[1],U=(0,i._)((0,r.useState)({1:!1,2:!1,3:!1,4:!1,5:!1,6:!1,7:!1,8:!1,9:!1}),2),Z=U[0],J=U[1],V=(0,i._)((0,r.useState)(null),2),X=V[0],G=V[1],W=(0,i._)((0,r.useState)({1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0}),2),q=W[0],Y=W[1],$=(0,i._)((0,r.useState)({10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0,24:0,25:0,26:0,27:0,28:0,29:0,30:0,31:0,32:0}),2),K=$[0],Q=$[1],ee={1:["10","11"],2:["12","13"],3:["14","15"],4:["16","17","18"],5:["19","20","21"],6:["22","23"],7:["24","25","26","27"],8:["28","29","30"],9:["31","32"]},en={10:"1",11:"1",12:"2",13:"2",14:"3",15:"3",16:"4",17:"4",18:"4",19:"5",20:"5",21:"5",22:"6",23:"6",24:"7",25:"7",26:"7",27:"7",28:"8",29:"8",30:"8",31:"9",32:"9"},et=(0,i._)((0,r.useState)("annotation"),2),ea=et[0],ei=et[1],es=(0,i._)((0,r.useState)(!1),2),eo=es[0],er=es[1],showHideSubcategory=function(e){J((0,m._)((0,a._)({},Z),(0,u._)({},e,!Z[e])))},sliderChange=function(e,n){Q((0,m._)((0,a._)({},K),(0,u._)({},e,parseInt(n))))},closeAnnotation=function(){_(),resetAnnotation(),O(null),ei("annotation")},resetAnnotation=function(){if(f){var e=(0,a._)({},K);Object.keys(e).map(function(n,t){e[n]=0}),Q(e);var n=(0,a._)({},q);Object.keys(n).map(function(e,t){n[e]=0}),Y(n);var t=(0,a._)({},Z);Object.keys(t).map(function(e,n){t[e]=!1}),J(t)}},saveAnnotation=function(e){f&&(l?N(l.cid,l.content.notes,q,K):b(window.items,q,K,function(n){n.message&&(e||alert("Annotate successfully!"),O(n.annotation_id))}))},onMouseMove=function(e){T&&I({x:e.clientX-L.x,y:e.clientY-L.y})},onMouseUp=function(){A(!1)},load_feedback_info=function(e){if(X){var n=[];Object.keys(q).map(function(e,t){n.push(X[e].cid)});var t={user_feedback_id:e,annotation_item_id:JSON.stringify(n)};(0,p.Vi)(t,function(e){var n=e.feedbacks;Object.keys(q).map(function(e,t){X[e].feedback=n[t]})})}},react=function(e,n){var t=X[e].feedback;if(t&&t.feedback==n)(0,p.yz)(t.fid,function(n){if(n.message){var t=(0,a._)({},X);t[e].feedback=null,G(t)}});else{var i={annotation_item_id:X[e].cid,user_feedback_id:F.uid,feedback:n};(0,p.PP)(i,function(t){var i=t.fid;if(i){var s=(0,a._)({},X);s[e].feedback={fid:i,feedback:n,user_feedback_id:F.uid},G(s)}})}};return(0,r.useEffect)(function(){if(j){if(l){console.log(l);var e=l.annot_items;G(e),O(l.cid);var n=l.content.annotations,t=(0,a._)({},Z);Object.keys(n).map(function(a,i){a in e?(e[a]>0&&(t[en[a]]=!0),n[a]=e[a]):n[a]=0}),Q((0,a._)({},K,n)),J(t);var i=l.content.annotations1;i&&(Object.keys(i).map(function(n,t){n in e?i[n]=e[n]:i[n]=0}),Y((0,a._)({},q,i)))}else resetAnnotation()}},[j,l]),(0,r.useEffect)(function(){return T?(window.addEventListener("mousemove",onMouseMove),window.addEventListener("mouseup",onMouseUp)):(window.removeEventListener("mousemove",onMouseMove),window.removeEventListener("mouseup",onMouseUp)),function(){window.removeEventListener("mousemove",onMouseMove),window.removeEventListener("mouseup",onMouseUp)}},[T]),(0,r.useEffect)(function(){S((0,v.G3)());var e=(0,v.PR)();load_feedback_info(e.uid),H(e)},[]),(0,o.jsxs)("div",{className:"ui-block annotation-container "+(j?"":"hidden"),style:{top:P.y+"px",left:P.x+"px",cursor:T?"grabbing":"grab"},onMouseDown:function(e){B({x:e.clientX-P.x,y:e.clientY-P.y}),A(!0)},children:[(0,o.jsxs)("div",{className:"ui-block-title",children:[(0,o.jsxs)("div",{className:"row",children:[(0,o.jsx)("div",{className:"col col-4 annotation-tab "+("annotation"==ea?"active":""),children:(0,o.jsx)("button",{className:"btn btn-outline-dark",onClick:function(){ei("annotation")},children:(0,o.jsx)("i",{className:"far fa-list-music"})})}),(0,o.jsx)("div",{className:"col col-4 annotation-tab "+("comment"==ea?"active":""),children:(0,o.jsx)("button",{className:"btn btn-outline-dark",onClick:function(){ei("comment"),D||saveAnnotation(!0)},children:(0,o.jsx)("i",{className:"far fa-comment"})})}),(0,o.jsx)("div",{className:"col col-4 annotation-tab "+("voice"==ea?"active":""),children:(0,o.jsx)("button",{className:"btn btn-outline-dark",onClick:function(){ei("voice"),D||saveAnnotation(!0)},children:(0,o.jsx)("i",{className:"far fa-microphone"})})})]}),(0,o.jsx)("button",{className:"btn btn-primary close-button",onClick:closeAnnotation,children:(0,o.jsx)("i",{className:"fa fa-times"})})]}),(0,o.jsx)("div",{className:"annotation-scroll",children:(0,o.jsxs)("div",{className:"flex flex-wrap flex-col annotation-wrapper",children:["annotation"==ea&&["9","1","2","3","4","5","6","7","8"].map(function(e,n){var t=x.S[k][e],i=ee[e];return(0,o.jsxs)("div",{className:"annotation-item",children:[(0,o.jsxs)("div",{className:"annotation-item-head px-2 py-1 font-semibold "+(Z[e]?"annotation_selected":" "),onClick:function(){showHideSubcategory(e)},children:[(0,o.jsx)("div",{children:t}),(0,o.jsxs)("div",{onClick:function(e){e.stopPropagation()},className:"flex",children:[(0,o.jsx)(StarMetric,{id:"level-1",style:{width:"10.4px",height:"20px"},value:q[e],selectAction:function(n){if(f){var t=(0,a._)({},q);t[e]=n,Y(t)}},enable:f}),"student"==F.user_type&&X&&X[e]&&0!=X[e]?(0,o.jsxs)("div",{className:"reaction-info level1-feedback-area",children:[(0,o.jsx)("button",{className:"reaction-button inline-items "+(X[e].feedback&&1==X[e].feedback.feedback?"reaction-active":""),onClick:function(){return react(e,1)},children:(0,o.jsx)("i",{className:"far fa-thumbs-up"})}),(0,o.jsx)("button",{className:"reaction-button inline-items "+(X[e].feedback&&0==X[e].feedback.feedback?"reaction-active":""),onClick:function(){return react(e,0)},children:(0,o.jsx)("i",{className:"far fa-thumbs-down"})})]}):(0,o.jsx)(o.Fragment,{})]})]}),(0,o.jsx)("div",{className:"annotation-item-sub px-2 py-1 "+(Z[e]?" ":"hidden"),children:i.map(function(n,t){var a=x.S[k][n].split(" vs. ");return(0,o.jsxs)("div",{className:"annotation-item-sub-wrapper "+("student"==F.user_type&&X&&0!=X[n]?"sub-wrapper-fb":""),children:[(0,o.jsx)(Level2Scale,{enable:f,parentId:e,id:n,score:K[n],labels:a,onChange:sliderChange,annotation:l}),"student"==F.user_type&&X&&X[n]&&0!=X[n]?(0,o.jsxs)("div",{className:"reaction-info feedback-area",children:[(0,o.jsx)("button",{className:"reaction-button inline-items "+(X[n].feedback&&1==X[n].feedback.feedback?"reaction-active":""),onClick:function(){return react(n,1)},children:(0,o.jsx)("i",{className:"far fa-thumbs-up"})}),(0,o.jsx)("button",{className:"reaction-button inline-items "+(X[n].feedback&&0==X[n].feedback.feedback?"reaction-active":""),onClick:function(){return react(n,0)},children:(0,o.jsx)("i",{className:"far fa-thumbs-down"})})]}):(0,o.jsx)(o.Fragment,{})]},t)})})]},e)}),"comment"==ea&&D&&F.uid&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(g.Z,{type:"performance",pid:D,userId:F.uid,needCommentRefresh:eo,setNeedCommentRefresh:er}),d.created_user_id==F.uid&&(0,o.jsx)(h.Z,{user:F,pid:s,type:"performance",aid:D,onNewComment:function(){er(!0)}})]}),"voice"==ea&&D&&F.uid&&(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(voice_comment,{user:F,pid:s,aid:D,enable:F.uid==d.created_user_id})})]})}),"annotation"==ea&&d.created_user_id==F.uid&&(0,o.jsxs)("div",{className:"annotation-action row-flex",style:{justifyContent:"space-between"},children:[(0,o.jsxs)("div",{className:"annot-hint",children:[(0,o.jsx)("p",{className:"observation",children:(0,v.id)(k,"observation")}),(0,o.jsx)("p",{className:"suggestion",children:(0,v.id)(k,"suggestion")})]}),(0,o.jsxs)("div",{className:"flex-end "+ +(f?"":"hidden"),children:[(0,o.jsxs)("button",{className:"btn btn-outline-dark",onClick:resetAnnotation,children:[(0,o.jsx)("i",{className:"far fa-redo"}),"\xa0",(0,v.id)(k,"reset")]}),l&&(0,o.jsxs)("button",{className:"btn btn-outline-danger",onClick:function(){l&&(0,p.rT)(l.cid,function(){closeAnnotation(),w(l,l.cid)})},children:[(0,o.jsx)("i",{className:"far fa-trash"}),"\xa0",(0,v.id)(k,"delete")]}),(0,o.jsxs)("button",{className:"btn btn-outline-primary",onClick:function(){saveAnnotation(!1)},children:[(0,o.jsx)("i",{className:"far fa-save"}),"\xa0",(0,v.id)(k,"save")]})]})]})]})}var y=t(4827),k=t(6895),S=t(1163),C=t.n(S),P=t(2452);function MidiPlayer(e){var n=e.url,a=e.title,s=e.id,c=e.isActive,l=e.offset,d=e.onPlay,u=e.onStop,m=e.onMove,h=e.onLoad,x=e.pageTracking,g=e.alignPage,b=e.userId,w=e.assignmentId,N=(0,r.useRef)(c),y=(0,r.useRef)(l),k=(0,r.useRef)(),S=(0,i._)((0,r.useState)(!1),2),I=S[0],M=S[1],T=(0,i._)((0,r.useState)(!1),2),A=T[0],E=T[1],L=(0,i._)((0,r.useState)(!1),2),B=L[0],R=L[1],F=(0,i._)((0,r.useState)(null),2),H=F[0],z=F[1],D=(0,i._)((0,r.useState)(null),2),O=D[0],U=D[1],Z=(0,r.useRef)(null),J=(0,i._)((0,r.useState)(0),2),V=J[0],X=J[1],G=(0,i._)((0,r.useState)(0),2),W=G[0],q=G[1],Y=(0,i._)((0,r.useState)(0),2),$=Y[0],K=Y[1],Q=(0,i._)((0,r.useState)(0),2),ee=Q[0],en=Q[1],et=(0,i._)((0,r.useState)("00:00"),2),ea=et[0],ei=et[1],timeToString=function(e){var n=String(Math.floor(e/60)).padStart(2,"0"),t=String(Math.round(e%60)).padStart(2,"0");return"".concat(n,":").concat(t)},updateProgress=function(e){var n=e/W*100;ei(timeToString(e)),X(n)},checkProgressInterval=function(){K(setInterval(function(){var e=window.Tone.Transport.seconds;if(updateProgress(e),x&&g){var n=(0,v.ml)(x,e)-1;n>=0&&n<x.length&&n!=k.current&&(k.current=n,g(n))}e>=W&&u()},100))},scheduleNotes=function(){window.Tone.Transport.cancel(0),H.tracks.forEach(function(e){e.notes.forEach(function(e){window.Tone.Transport.schedule(function(n){window.instrument.triggerAttackRelease(e.name,e.duration,n,e.velocity)},e.time)})})},playAction=function(){B&&!A&&(E(!0),scheduleNotes(),I?window.Tone.Transport.start():(M(!0),window.Tone.start().then(window.Tone.Transport.start())),ee>=W?(en(0),window.Tone.Transport.seconds=0):window.Tone.Transport.seconds=ee,checkProgressInterval())},resetTransport=function(){window.Tone.Transport.stop(),window.Tone.Transport.cancel(0)},stopAction=function(){E(!1),clearInterval($),en(window.Tone.Transport.seconds),resetTransport()},stop=function(){u(),s||stopAction()},initPlayer=function(){t.e(757).then(t.bind(t,9338)).then(function(e){function _loadMidi(){return(_loadMidi=(0,j._)(function(n){var t,a,i;return(0,_.Jh)(this,function(s){switch(s.label){case 0:return[4,n.arrayBuffer()];case 1:return t=s.sent(),a=new P.Midi(t),window.instrument=new window.Tone.Sampler({urls:f.$d,release:1,baseUrl:"/piano_files/"}).toDestination(),i=new e.Reverb({decay:2.5,wet:.3}).toDestination(),window.instrument.connect(i),a.tracks.forEach(function(e){if(e.controlChanges[64]){var n=[];e.controlChanges[64].forEach(function(e){e.value>0&&n.length%2==0?n.push(e.time):0==e.value&&n.length%2==1&&n.push(e.time)}),n.length&&e.notes.forEach(function(e){var t=(0,v.Nw)(n,e.time+e.duration);if(t<n.length&&t%2==1){var a=n[t]-e.time;e.duration=Math.max(e.duration,a)}})}}),q(a.duration),R(!0),z(a),h&&h(),[2]}})})).apply(this,arguments)}window.Tone=e,fetch(n).then(function(e){!function(e){_loadMidi.apply(this,arguments)}(e)}).catch(function(e){console.log(e)})})},getSubmissions=function(){b&&w&&(0,p.DA)(b,w,function(e){U(e)})},selectVersion=function(e){C().push("/annotation?pid="+e.pid)};return(0,r.useEffect)(function(){return getSubmissions(),C().events.on("routeChangeStart",function(e){window.Tone&&stop()}),function(){C().events.off("routeChangeStart")}},[]),(0,r.useEffect)(function(){if(B||initPlayer(),c!==N.current&&(c?playAction():stopAction()),null!=l&&l!=y.current){var e=x[l];window.Tone.Transport.seconds=e,updateProgress(e),en(e),l>=0&&l<x.length&&l!=k.current&&(k.current=l)}N.current=c,y.current=l},[c,l]),(0,o.jsxs)("div",{className:"ui-block",children:[(0,o.jsxs)("div",{className:"ui-block-title flex",style:{justifyContent:"space-between",padding:"10px 20px",alignItems:"center"},children:[(0,o.jsx)("a",{className:"h6",children:a}),(0,o.jsx)("div",{children:w&&O?(0,o.jsx)("fieldset",{className:"form-group",style:{margin:0,padding:"0px"},children:(0,o.jsx)("select",{className:"form-select",onChange:function(e){selectVersion(sitem)},style:{padding:"10px 30px 10px 10px"},children:O.map(function(e,n){return(0,o.jsx)("option",{value:e.pid,children:e.updated_at},e.pid)})})}):(0,o.jsx)(o.Fragment,{})})]}),(0,o.jsx)("div",{className:"ui-block-content",children:(0,o.jsxs)("div",{className:"player-container flex row-flex ",children:[(0,o.jsx)("div",{className:"player-action inner-flex",children:A?(0,o.jsx)("button",{className:"btn btn-outline-primary",onClick:stop,children:(0,o.jsx)("i",{className:"fa fa-pause"})}):(0,o.jsx)("button",{className:"btn btn-outline-primary",onClick:function(){!B||A||(d(),s||playAction())},children:(0,o.jsx)("i",{className:"fa fa-play"})})}),(0,o.jsxs)("div",{className:"player-progress",ref:Z,onClick:function(e){var n=(e.clientX-Z.current.getBoundingClientRect().left)/Z.current.offsetWidth;X(100*n);var t=n*W;window.Tone.Transport.seconds=t,ei(timeToString(t)),A||en(t),m&&m(t)},children:[(0,o.jsx)("div",{className:"player-progress-bar",style:{width:"".concat(V,"%")}}),(0,o.jsx)("div",{className:"player-index",children:x&&W?(0,o.jsx)(o.Fragment,{children:x.map(function(e,n){var t=e/W*100;return(0,o.jsx)("div",{className:"player-index-tick",style:{left:t+"%"}},n)})}):(0,o.jsx)(o.Fragment,{})})]}),(0,o.jsxs)("div",{className:"player-time",children:[(0,o.jsx)("span",{children:ea}),"\xa0/\xa0",(0,o.jsx)("span",{children:timeToString(W)})]})]})})]})}function PerformancePlayer(e){var n=e.url,t=e.title,a=e.userId,s=e.assignmentId,c=(0,i._)((0,r.useState)(null),2),l=c[0],d=c[1],getSubmissions=function(){a&&s&&(0,p.DA)(a,s,function(e){d(e)})},selectVersion=function(e){C().push("/annotation?pid="+e.pid)};return(0,r.useEffect)(function(){getSubmissions()},[]),(0,o.jsxs)("div",{className:"ui-block",children:[(0,o.jsxs)("div",{className:"ui-block-title flex",style:{justifyContent:"space-between",padding:"10px 20px",alignItems:"center"},children:[(0,o.jsx)("a",{className:"h6",children:t}),(0,o.jsx)("div",{children:s&&l?(0,o.jsx)("fieldset",{className:"form-group",style:{margin:0,padding:"0px"},children:(0,o.jsx)("select",{className:"form-select",onChange:function(e){selectVersion(sitem)},style:{padding:"10px 30px 10px 10px"},children:l.map(function(e,n){return(0,o.jsx)("option",{value:e.pid,children:e.updated_at},e.pid)})})}):(0,o.jsx)(o.Fragment,{})})]}),(0,o.jsx)("div",{className:"ui-block-content",children:(0,o.jsx)(SimpleAudioPlayer,{url:n})})]})}var I=t(6366);function AnnotationTooltip(e){var n=e.x,t=e.y,a=e.show;return(0,o.jsx)("div",{className:"annotation-tooltip",style:{top:t+"px",left:n+"px"},children:(0,o.jsx)("button",{className:"btn btn-outline-dark btn-tooltip",onClick:function(){a()},children:(0,o.jsx)("i",{className:"far fa-eye"})})})}function Annotation(){var e=(0,i._)((0,r.useState)("en"),2),n=e[0],l=e[1],u=(0,i._)((0,r.useState)(!1),2),m=u[0],f=u[1],h=(0,i._)((0,r.useState)({}),2),x=h[0],g=h[1],j=(0,c.useSearchParams)().get("pid"),_=(0,i._)((0,r.useState)(!0),2),b=_[0];_[1];var w=(0,i._)((0,r.useState)(!1),2),N=w[0],S=w[1],C=(0,i._)((0,r.useState)(!1),2),P=C[0],M=C[1],T=(0,i._)((0,r.useState)(!1),2),A=T[0],E=T[1],L=(0,i._)((0,r.useState)(null),2),B=L[0],R=L[1],F=(0,i._)((0,r.useState)(1),2),H=F[0],z=F[1],D=(0,i._)((0,r.useState)(null),2),O=D[0],U=D[1],Z=(0,i._)((0,r.useState)(null),2),J=Z[0],V=Z[1],X=(0,i._)((0,r.useState)(0),2),G=X[0],W=X[1],q=(0,i._)((0,r.useState)([]),2),Y=q[0],$=q[1],K=(0,i._)((0,r.useState)([]),2),Q=K[0],ee=K[1],en=(0,i._)((0,r.useState)(null),2),et=en[0],ea=en[1],ei=(0,i._)((0,r.useState)(!1),2),es=ei[0],eo=ei[1],er=(0,i._)((0,r.useState)(!1),2),ec=er[0],el=er[1],ed=(0,i._)((0,r.useState)(null),2),eu=ed[0],em=ed[1],ef=(0,i._)((0,r.useState)({}),2),eh=ef[0],ev=ef[1],ex=(0,i._)((0,r.useState)([]),2),ep=ex[0],eg=ex[1],ej=(0,i._)((0,r.useState)({}),2),e_=ej[0],eb=ej[1],ew=(0,i._)((0,r.useState)([]),2),eN=ew[0],ey=ew[1],ek=(0,r.useRef)(null),eS=(0,r.useRef)(null),visualizePage=function(e){f(!0);var n=J[e];ek.current.innerHTML=n,setPageAnnotations(eN,e),U(e),z(e+1),setTimeout(function(){updateSelection(),f(!1),window.startIndex&&window.endIndex&&highlightMeasureBetween(window.startIndex,window.endIndex)},200)},generateNext=function(){if(J&&O<G-1){var e=O+1;visualizePage(e),R(e)}},generatePrev=function(){if(J&&0!=O){var e=O-1;visualizePage(e),R(e)}},changePage=function(){var e=H;(!e||e<1)&&(e=1),e>=G&&(e=G),z(e);var n=parseInt(e)-1;visualizePage(n),R(n)},buildMeasurePageMap=function(e,n,t){for(var a=0;a<e.length;a++)t[e[a].id]=n},renderBarPage=function(e){window.verovioToolkit.setOptions({scale:50,scaleToPageSize:!0,pageWidth:eS.current.getBoundingClientRect().width,pageHeight:1430}),window.verovioToolkit.loadData(e);var n=window.verovioToolkit.getPageCount();W(n),U(0);for(var t=[],a=[1],i={},s=0;s<n;s++){var o=window.verovioToolkit.renderToSVG(s+1),r={measures:new DOMParser().parseFromString(o,"image/svg+xml").getElementsByClassName("measure")}.measures;a.push(a[a.length-1]+r.length),t.push(o),buildMeasurePageMap(r,s,i)}return V(t),ee(a),ev(i),{svgs:t,measureTracking:a}},processStudentPerformance=function(e,n){var t=e.performance_onset,a=e.performance_measure;if(t&&a){for(var i=[],s=0;s<n.length-1;s++){var o=(0,v.Nw)(a,n[s]);a[o]==n[s]||a[o]>n[s]&&a[o]<n[s+1]?i.push(t[o]):0==s&&i.push(0)}$(i)}},updateSelection=function(){"student"!=(0,v.PR)().user_type&&initSelection()},highlightMeasureBetween=function(e,n){if(e>n){var t=e;e=n,n=t}for(var a=[],i=e;i<=n;i++){a.push(window.measureIndexMap[i]);var s=document.getElementById(measureIndexMap[i]);s&&s.classList.add("selected")}window.items=a},normalizeMeasureBetween=function(e,n){if(e>n){var t=e;e=n,n=t}for(var a=e;a<=n;a++){var i=document.getElementById(window.measureIndexMap[a]);i&&(i.classList.remove("selected"),a==e&&i.classList.remove("annotated-start"),a==n&&i.classList.remove("annotated-end"))}window.items=[]},initSelection=function(){"student"!=(0,v.PR)().user_type&&document.querySelectorAll(".measure").forEach(function(e){e.addEventListener("click",function(n){if("end"==window.selectState){if(window.startId){var t=document.getElementById(window.startId);t&&t.classList.remove("annotated-start")}window.startIndex&&window.endIndex&&normalizeMeasureBetween(window.startIndex,window.endIndex),window.startId=e.id;var a=window.measureMap[e.id];window.selectState="start",e.classList.add("annotated-start"),window.startIndex=a,window.endIndex=null,window.endId=null}else{if(window.endId){var i=document.getElementById(window.endId);i&&i.classList.remove("annotated-end")}window.endId=e.id;var s=window.measureMap[e.id];window.selectState="end",e.classList.add("annotated-end"),window.endIndex=s,highlightMeasureBetween(window.startIndex,window.endIndex)}})})},enableAnnotationBox=function(){eo(!0)},showAnnotationBox=function(e){window.items&&window.items.length&&(e.preventDefault(),em(null),el(x.uid==e_.assignment.created_user_id),enableAnnotationBox())},insertAnnotationLocal=function(e,n,t,i,o,r){var c={user_id:x.uid,access_control:1,avatar:x.avatar,cid:e,start_bar:n,end_bar:t,content:i,annot_items:(0,a._)({},o,r)};ey(function(e){return(0,s._)(e).concat([c])}),eg(function(e){return(0,s._)(e).concat([c])})},focusAnnotation=function(e,n){for(var t=e.content.notes,a=0;a<t.length;a++){var i=document.getElementById(t[a]);i&&i.classList.add("annotated")}},unFocusAnnotation=function(e){for(var n=e.content.notes,t=0;t<n.length;t++){var a=document.getElementById(n[t]);a&&a.classList.remove("annotated")}},getAnnotationPosition=function(e){var n=eS.current.getBoundingClientRect(),t=document.getElementById(e),a={x:0,y:0};if(t){var i=t.getBoundingClientRect();a={x:i.x-n.x+(0,v.xT)(0,200),y:i.y-n.y-30-(0,v.xT)(0,30)}}return a},loadPerformanceData=function(){var buildMeasureMap=function(e){for(var n={},t={},a=0;a<e.length;a++)n[e[a]]=a+1,t[a+1]=e[a];window.measureMap=n,window.measureIndexMap=t},init=function(e,n){if(el((0,v.PR)().uid==e.assignment.created_user_id),n){var t=renderBarPage(n);ek.current.innerHTML=t.svgs[0],initSelection(),M(!0),eb(e),"MIDI"!=(0,v.JB)(e.performance_midi_path)&&S(!0),processStudentPerformance(e,t.measureTracking)}};(0,p.X9)(j,function(e){e.part_id?(0,p.CE)(e.part_id,function(n){buildMeasureMap(n.measures),init(e,n.data)}):(0,p.kd)(e.song_id,function(n){buildMeasureMap(n.measures),init(e,n.data)})})},setPageAnnotations=function(e,n){for(var t=[],a=0;a<e.length;a++){var i=e[a].content.notes;i.length&&eh.hasOwnProperty(i[0])&&(eh[i[0]]==n?t.push(e[a]):i.length>1&&eh[i[i.length-1]]==n&&t.push(e[a]))}eg(t)};return(0,r.useEffect)(function(){b&&N&&P&&((0,p.h)(j,function(e){ey(e),setPageAnnotations(e,0)}),f(!1))},[b,N,P]),(0,r.useEffect)(function(){l((0,v.G3)()),window.selectState="end",window.startIndex=null,window.endIndex=null,window.startId=null,window.endId=null,window.measureMap=null,window.measureIndexMap=null,ea({x:window.innerWidth/2-300,y:window.innerHeight/2-263}),j&&(f(!0),g((0,v.PR)()),window.verovio?(window.verovioToolkit=new window.verovio.toolkit,loadPerformanceData()):Promise.all([t.e(752),t.e(714),t.e(817),t.e(565)]).then(t.t.bind(t,393,23)).then(function(e){window.verovio=e;var n=setInterval(function(){try{window.verovioToolkit=new window.verovio.toolkit,clearInterval(n),loadPerformanceData()}catch(e){}},50)}),b&&N&&P&&f(!1))},[]),(0,o.jsxs)("div",{className:"annotation-page",children:[(0,o.jsx)("div",{className:"loading",style:m?{display:"flex"}:{display:"none"},children:(0,o.jsx)("img",{src:"svg-icons/spinner.svg"})}),(0,o.jsx)(y.Z,{title:"Performance",css:{position:"absolute"}}),(0,o.jsx)("div",{className:"header-spacer"}),(0,o.jsx)("div",{className:"explanation-container",children:(0,o.jsxs)("div",{className:"fix-left-container",children:[(0,o.jsxs)("div",{className:"row",children:[(0,o.jsx)("div",{className:"col col-xl-4 col-lg-4 col-md-4 col-sm-12 col-12",children:(0,o.jsx)("div",{className:"ui-block",children:(0,o.jsxs)("div",{className:"ui-block-title row-flex",children:[(0,o.jsx)("div",{className:"author-thumb inline-flex",children:(0,o.jsx)("div",{className:"icon",children:(0,o.jsx)("i",{className:"far fa-users-class"})})}),(0,o.jsxs)("div",{className:"inline-flex annotation-title-content",children:[(0,o.jsx)("a",{className:"h6",children:(0,v.id)(n,"class_information")}),e_.assignment?(0,o.jsx)("div",{children:e_.assignment.classname}):(0,o.jsx)("div",{children:(0,v.id)(n,"no_information")})]})]})})}),(0,o.jsx)("div",{className:"col col-xl-4 col-lg-4 col-md-4 col-sm-12 col-12",children:(0,o.jsx)("div",{className:"ui-block",children:(0,o.jsxs)("div",{className:"ui-block-title row-flex",children:[(0,o.jsx)("div",{className:"author-thumb inline-flex",children:(0,o.jsx)("div",{className:"icon",children:(0,o.jsx)("i",{className:"far fa-tasks"})})}),(0,o.jsxs)("div",{className:"inline-flex annotation-title-content",children:[(0,o.jsx)("a",{className:"h6",children:(0,v.id)(n,"assignment_information")}),e_.assignment?(0,o.jsx)("div",{children:e_.assignment.name}):(0,o.jsx)("div",{children:(0,v.id)(n,"no_information")})]})]})})}),(0,o.jsx)("div",{className:"col col-xl-4 col-lg-4 col-md-4 col-sm-12 col-12",children:(0,o.jsx)("div",{className:"ui-block",children:(0,o.jsxs)("div",{className:"ui-block-title row-flex",children:[(0,o.jsx)("div",{className:"author-thumb inline-flex",children:(0,o.jsx)("div",{className:"author-thumb",children:(0,o.jsx)(d(),{href:"/profile?uid="+e_.user_id,children:e_.avatar?(0,o.jsx)("img",{loading:"lazy",src:e_.avatar,alt:"photo",width:"36",height:"36"}):(0,o.jsx)("img",{loading:"lazy",src:"img/avatar1.webp",alt:"photo",width:"36",height:"36"})})})}),(0,o.jsxs)("div",{className:"inline-flex annotation-title-content",children:[(0,o.jsx)("a",{className:"h6",children:(0,v.id)(n,"performer_name")}),(0,o.jsx)("div",{children:(0,o.jsx)(d(),{href:"/profile?uid="+e_.user_id,children:e_.fullname})})]})]})})})]}),(0,o.jsx)("div",{className:"row",children:(0,o.jsx)("div",{className:"col col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12",children:e_&&e_.performance_midi_path?(0,o.jsx)(o.Fragment,{children:"MIDI"!=(0,v.JB)(e_.performance_midi_path)?(0,o.jsx)(PerformancePlayer,{url:e_.performance_midi_path,title:e_.name+"-"+e_.updated_at+(e_.start_bar?" (Measures:"+e_.start_bar+"-"+e_.end_bar+")":""),userId:e_.user_id,assignmentId:e_.assignment_id}):(0,o.jsx)(MidiPlayer,{url:e_.performance_midi_path,title:e_.name+"-"+e_.updated_at+(e_.start_bar?" (Measures:"+e_.start_bar+"-"+e_.end_bar+")":""),id:"performance_midi",offset:B,isActive:"performance_midi"==A,onPlay:function(){return E("performance_midi")},onStop:function(){return E(null)},onLoad:function(){S(!0)},onMove:function(e){var n=e_.performance_onset;if(n){var t=(0,v.ml)(n,e);if(n[t]==e&&(t-=1),!(t>=e_.performance_measure.length)){var a=parseInt(e_.performance_measure[t]);if(isNaN(a)||a<0)for(;--t&&(isNaN(a=parseInt(e_.performance_measure[t]))||!(a>0)););visualizePage((0,v.ml)(Q,a)-1)}}},pageTracking:Y,alignPage:visualizePage,userId:e_.user_id,assignmentId:e_.assignment_id})}):(0,o.jsx)(o.Fragment,{})})})]})}),(0,o.jsx)("div",{className:"explanation-container",children:(0,o.jsx)("div",{className:"fix-left-container",ref:eS,style:{minHeight:"1530px",marginBottom:"30px"},children:(0,o.jsxs)("div",{className:"bar_container selectable",id:"barContainer",onContextMenu:showAnnotationBox,onTouchStart:function(e){2==e.touches.length&&showAnnotationBox(e)},style:{height:"1530px"},children:[(0,o.jsxs)("div",{className:"level0-container",children:[(0,o.jsx)("div",{style:{marginRight:"5px",fontSize:"14px",lineHeight:"23px"},children:(0,v.id)(n,"overall_score")})," ",(0,o.jsx)(StarMetric,{id:"level-0",selectAction:function(e){ec&&(0,p.sL)(j,e,function(){var n=(0,a._)({},e_);n.score=e,eb(n)})},value:e_.score,enable:ec})]}),(0,o.jsx)("div",{className:"mode-switch",children:(0,o.jsxs)("select",{onChange:function(){},children:[(0,o.jsx)("option",{children:(0,v.id)(n,"manual_annotation")}),(0,o.jsx)("option",{children:(0,v.id)(n,"automated_annotation")})]})}),(0,o.jsx)("button",{className:"btn btn-outline-primary bar_nav_bt "+(G>1?"show":""),onClick:generatePrev,children:(0,o.jsx)("i",{className:"fa fa-chevron-left"})}),(0,o.jsx)("button",{className:"btn btn-outline-primary bar_nav_bt bar_nav_bt_right "+(G>1?"show":""),onClick:generateNext,children:(0,o.jsx)("i",{className:"fa fa-chevron-right"})}),(0,o.jsx)("div",{ref:ek}),(0,o.jsx)("div",{className:"bar-pagination-wrapper "+(m?"hidden":""),children:(0,o.jsxs)("div",{className:"bar-pagination",children:[(0,o.jsx)("button",{className:"btn btn-outline-primary "+(G<=1?"hidden":""),onClick:generatePrev,children:(0,o.jsx)("i",{className:"fa fa-chevron-left"})}),(0,o.jsx)("input",{className:"bar-pagination-item",value:H,type:"number",onChange:function(e){z(e.target.value)},onKeyDown:function(e){"Enter"==e.key&&changePage()}}),(0,o.jsx)("div",{className:"bar-pagination-slash",children:(0,o.jsx)("div",{children:"/"})}),(0,o.jsx)("div",{className:"bar-pagination-item",children:(0,o.jsx)("div",{children:G})}),(0,o.jsx)("button",{className:"btn btn-outline-primary "+(G<=1?"hidden":""),onClick:generateNext,children:(0,o.jsx)("i",{className:"fa fa-chevron-right"})})]})}),(0,o.jsx)("div",{className:"annotation-overlay-container",children:0!=ep.length&&ep.map(function(e,n){e.expanded=!1;var t=e.content.notes,a={x:0,y:0},i=eh[t[0]];return i!=O?(i=O,a=getAnnotationPosition(t[t.length-1])):a=getAnnotationPosition(t[0]),(0,o.jsx)(AnnotationTooltip,{x:a.x,y:a.y,show:function(){em(e),eo(!0),focusAnnotation(e,i)}},e.cid)})})]})})}),x&&et&&e_&&e_.assignment?(0,o.jsx)(AnnotationForm,{x:et.x,y:et.y,pid:j,annotation:eu,assignment:e_.assignment,show:es,enable:ec,close:function(){eo(!1),em(null),window.items&&(window.items=[]),window.startIndex&&window.endIndex&&normalizeMeasureBetween(window.startIndex,window.endIndex)},save:function(e,n,t,a){var i=e[0],s=e[e.length-1],o={notes:e,annotations1:n,annotations:t},r=(0,v.VN)();(0,p.Iy)(j,r,JSON.stringify(o),i,s,function(e){insertAnnotationLocal(e.annotation_id,i,s,o,n,t),a(e)})},update:function(e,n,t,i){var updateList=function(e,n,t){var a=e.findIndex(function(e){return e.cid==n.cid});if(-1!=a){var i=(0,s._)(e);i[a]=n,t(i)}},o={notes:n,annotations1:t,annotations:i};(0,p.U1)(e,JSON.stringify(o),function(e){if(e.message){alert("Update successfully!");var n=(0,a._)({},t,i),s=(0,a._)({},eu);s.annot_items=n,s.content=o,updateList(ep,s,eg),updateList(eN,s,ey)}})},remove:function(e,n){unFocusAnnotation(e),eg(ep.filter(function(e){return e.cid!=n}))}}):(0,o.jsx)(o.Fragment,{}),(0,o.jsx)(I.Z,{}),(0,o.jsx)(k.Z,{pageNum:4})]})}}},function(e){e.O(0,[571,424,332,668,980,774,888,179],function(){return e(e.s=223)}),_N_E=e.O()}]);