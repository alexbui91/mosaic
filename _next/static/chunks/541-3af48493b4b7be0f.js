"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[541],{9541:function(e,a,t){t.d(a,{Z:function(){return ProfileCover}});var i=t(1309),r=t(5893),n=t(7294),s=t(1163),l=t(1664),c=t.n(l),o=t(7904),u=t(8878),d=t(1010),h=t(7582),m=t(2084);t(8844);var f=t(7066);function AvatarHandler(e){var a,t,s,l,c,u=e.isShow,g=e.closePopup,p=e.aspect,v=e.imageType,x=e.onSuccess,j=(0,i._)((0,n.useState)("en"),2),b=j[0],w=j[1],N=(0,i._)((0,n.useState)(""),2),_=N[0],y=N[1],C=(0,n.useRef)(null),S=(0,n.useRef)(null);(0,n.useRef)(null);var k=(0,n.useRef)(""),H=(0,i._)((0,n.useState)(null),2),R=H[0],E=H[1],L=(0,i._)((0,n.useState)(null),2),F=L[0],U=L[1];a=(0,d._)(function(){return(0,h.Jh)(this,function(e){return(null==F?void 0:F.width)&&(null==F?void 0:F.height)&&S.current&&C.current&&W(S.current,C.current,F,1,0),[2]})}),t=[F,1],(0,n.useEffect)(function(){var e=setTimeout(function(){a.apply(void 0,t)},100);return function(){clearTimeout(e)}},t);var W=(s=(0,d._)(function(e,a,t){var i,r,n,s,l,c,o,u,d,m=arguments;return(0,h.Jh)(this,function(h){if(i=m.length>3&&void 0!==m[3]?m[3]:1,m.length>4&&void 0!==m[4]&&m[4],!(r=a.getContext("2d")))throw Error("No 2d context");return n=e.naturalWidth/e.width,s=e.naturalHeight/e.height,l=window.devicePixelRatio,a.width=Math.floor(t.width*n*l),a.height=Math.floor(t.height*s*l),r.scale(l,l),r.imageSmoothingQuality="high",c=t.x*n,o=t.y*s,u=e.naturalWidth/2,d=e.naturalHeight/2,r.save(),r.translate(-c,-o),r.translate(u,d),r.scale(i,i),r.translate(-u,-d),r.drawImage(e,0,0,e.naturalWidth,e.naturalHeight,0,0,e.naturalWidth,e.naturalHeight),r.restore(),[2]})}),function(e,a,t){return s.apply(this,arguments)}),P=(l=(0,d._)(function(){var e,a,t,i,r,n,s;return(0,h.Jh)(this,function(l){switch(l.label){case 0:if(e=S.current,a=C.current,!e||!a||!F)throw Error("Crop canvas does not exist");if(t=e.naturalWidth/e.width,i=e.naturalHeight/e.height,!(n=(r=new OffscreenCanvas(F.width*t,F.height*i)).getContext("2d")))throw Error("No 2d context");return n.drawImage(a,0,0,a.width,a.height,0,0,r.width,r.height),[4,r.convertToBlob({type:"image/jpeg",quality:1})];case 1:return s=l.sent(),k.current&&URL.revokeObjectURL(k.current),k.current=URL.createObjectURL(s),[2]}})}),function(){return l.apply(this,arguments)}),T=(c=(0,d._)(function(){var e,a,t,i;return(0,h.Jh)(this,function(r){switch(r.label){case 0:return[4,P()];case 1:r.sent(),r.label=2;case 2:return r.trys.push([2,5,,6]),e=new FormData,[4,fetch(k.current).then(function(e){return e.blob()})];case 3:return a=r.sent(),e.append("file",a,"croppedImage.jpeg"),console.log(e),t=(0,o.LH)()+"/api/upload_image",[4,f.Z.post(t,e)];case 4:if(!(i=r.sent().data).message)throw Error("Upload failed");return x(i.path),[3,6];case 5:return r.sent(),alert("Error uploading image"),[3,6];case 6:return[2]}})}),function(){return c.apply(this,arguments)});return(0,n.useEffect)(function(){w((0,o.G3)())}),(0,r.jsx)("div",{className:"modal fade photo-uploader "+(u?"show":""),children:(0,r.jsx)("div",{className:"modal-dialog window-popup",role:"document",children:(0,r.jsxs)("div",{className:"modal-content",children:[(0,r.jsx)("a",{className:"close icon-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:g,children:(0,r.jsx)("svg",{className:"olymp-close-icon",children:(0,r.jsx)("use",{xlinkHref:"#olymp-close-icon"})})}),(0,r.jsxs)("div",{className:"modal-body",children:[(0,r.jsxs)("div",{className:"image-box",children:[(0,r.jsx)("div",{className:"Crop-Controls",children:(0,r.jsx)("input",{type:"file",accept:"image/*",onChange:function(e){if(e.target.files&&e.target.files.length>0){E(void 0);var a=new FileReader;a.addEventListener("load",function(){var e;return y((null===(e=a.result)||void 0===e?void 0:e.toString())||"")}),a.readAsDataURL(e.target.files[0])}}})}),(0,r.jsxs)("div",{className:"row image-content",children:[(0,r.jsx)("div",{className:"col col-sm-12 col-12 col-xl-6 col-lg-6 col-md-6",children:!!_&&(0,r.jsx)(m.ZP,{crop:R,onChange:function(e,a){return E(a)},onComplete:function(e){return U(e)},aspect:p,maxWidth:"avatar"==v?500:1368,maxHeight:"avatar"==v?500:472,minWidth:768,minHeight:265,children:(0,r.jsx)("img",{ref:S,alt:"Crop me",src:_,style:{transform:"scale(".concat(1,")"),maxHeight:"avatar"==v?"500px":"400px",maxWidth:"avatar"==v?"":"100%"},onLoad:function(e){if(p){var a=e.currentTarget,t=a.width,i=a.height;E((0,m._H)((0,m.YG)({unit:"%",width:90},p,t,i),t,i))}}})})}),(0,r.jsx)("div",{className:"col col-sm-12 col-12 col-xl-6 col-lg-6 col-md-6",children:!!F&&(0,r.jsx)(r.Fragment,{children:(0,r.jsx)("div",{children:(0,r.jsx)("canvas",{ref:C,style:{border:"1px solid black",objectFit:"contain",width:F.width,height:F.height}})})})})]})]}),(0,r.jsx)("div",{className:"image-action",children:(0,r.jsxs)("button",{onClick:T,className:"btn btn-primary",children:[(0,r.jsx)("i",{className:"far fa-upload"}),"\xa0",(0,o.id)(b,"finish_&_upload")]})})]})]})})})}function ProfileCover(e){var a=e.userId,t=e.editable,l=(0,i._)((0,n.useState)("en"),2),d=l[0],h=l[1],m=(0,s.useRouter)().pathname,f=(0,i._)((0,n.useState)({}),2),g=f[0],p=f[1],v=(0,i._)((0,n.useState)(null),2),x=v[0],j=v[1],b=(0,i._)((0,n.useState)(!1),2),w=b[0],N=b[1],_=(0,i._)((0,n.useState)(!1),2),y=_[0],C=_[1],S=(0,i._)((0,n.useState)(0),2),k=S[0],H=S[1],R=(0,i._)((0,n.useState)(""),2),E=R[0],L=R[1],checkFollowStatus=function(e){(0,u.RO)(e,a,function(e){e.status?N(!0):N(!1)})};return(0,n.useEffect)(function(){h((0,o.G3)());var e=(0,o.PR)();p(e),e&&e.uid==a?j(e):(0,u.Le)(a,j),checkFollowStatus(e.uid)},[]),(0,r.jsxs)("div",{className:"ui-block",children:[(0,r.jsxs)("div",{className:"top-header top-header-favorit",children:[(0,r.jsxs)("div",{className:"top-header-thumb",style:{backgroundImage:x&&x.bg?"url('"+x.bg+"')":""},children:[(0,r.jsxs)("div",{className:"top-header-author",children:[(0,r.jsxs)("div",{className:"author-thumb",children:[x?(0,r.jsx)("img",{loading:"lazy",src:x.avatar,alt:"author",width:"120",height:"120"}):(0,r.jsx)("img",{loading:"lazy",src:"img/dalle_avatar.png",alt:"author",width:"120",height:"120"}),t&&(0,r.jsx)("button",{className:"upload-image",onClick:function(){H(1),C(!0),L("avatar")},children:(0,r.jsx)("i",{className:"far fa-camera"})})]}),(0,r.jsx)("div",{className:"author-content",children:x?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("a",{className:"h3 author-name",children:x.fullname}),(0,r.jsx)("div",{className:"country",children:x.description})]}):(0,r.jsx)(r.Fragment,{})})]}),t&&(0,r.jsx)("button",{className:"upload-image upload-bg",onClick:function(){H(1368/472),C(!0),L("bg")},children:(0,r.jsx)("i",{className:"far fa-camera"})})]}),(0,r.jsxs)("div",{className:"profile-section",children:[(0,r.jsx)("div",{className:"row",children:(0,r.jsx)("div",{className:"col col-xl-8 m-auto col-lg-8 col-md-12",children:(0,r.jsxs)("ul",{className:"profile-menu",children:[(0,r.jsx)("li",{children:(0,r.jsx)(c(),{href:a?"/profile?uid="+a:"/profile",className:"/profile"==m?"active":"",children:(0,o.id)(d,"timeline")})}),(0,r.jsx)("li",{children:(0,r.jsx)(c(),{href:a?"/about?uid="+a:"/about",className:"/about"==m?"active":"",children:(0,o.id)(d,"about")})}),(0,r.jsx)("li",{children:(0,r.jsx)(c(),{href:a?"/performances?uid="+a:"/performances",className:"/performances"==m?"active":"",children:(0,o.id)(d,"performances")})}),(0,r.jsx)("li",{children:(0,r.jsx)(c(),{href:a?"/friends?uid="+a:"/friends",className:"/friends"==m?"active":"",children:(0,o.id)(d,"friends")})})]})})}),a&&g.uid!=a&&(0,r.jsx)("div",{className:"control-block-button flex",children:(0,r.jsx)("div",{className:"inline-item",onClick:function(){var e=u.Db;w&&(e=u.Os),e(g.uid,a,function(e){e.message&&(1==w?N(0):N(1))})},children:w?"Following":"Follow"})})]})]}),y&&k&&E&&(0,r.jsx)(AvatarHandler,{isShow:y,closePopup:function(){C(!1)},aspect:k,onSuccess:function(e){var t={user_id:a};"avatar"==E?t.avatar=e:t.bg=e,(0,u.pp)(t,function(a){a.message?(alert("Update successfully!"),"avatar"==E?g.avatar=(0,o.LH)()+"/uploads/"+e:g.bg=(0,o.LH)()+"/uploads/"+e,j(g),p(g),(0,o.av)(g),C(!1),L("")):alert("Update fail!")})},imageType:E})]})}}}]);